# Implementation Plan: TradeVision AI 기반 주식 차트 분석 학습 플랫폼

**Branch**: `feature/tradevision-platform` | **Date**: 2025-11-16 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `.specify/features/tradevision-platform/spec.md`

## Summary

TradeVision은 초보 투자자가 차트 분석 기법을 학습하고 AI를 활용해 실전 투자 의사결정을 지원받을 수 있는 통합 플랫폼입니다. 핵심 기능은 (1) JWT 기반 사용자 인증, (2) 한국투자증권 OpenAPI를 통한 실시간 주식 데이터 조회, (3) OpenAI GPT-4 Vision을 활용한 차트 이미지 AI 분석, (4) 봉 종류별 최적 매매기법 추천, (5) 분석 히스토리 관리, (6) 기술적 분석 기법 학습 콘텐츠 제공입니다.

**기술적 접근**:
- Spring Boot 3.5.7 기반 RESTful API 서버 구축
- MariaDB (UTF-8mb4)를 사용한 데이터 영속화
- Spring Security + JWT를 통한 stateless 인증/인가
- 외부 API 통합: 한국투자증권 OpenAPI (주식 데이터), OpenAI GPT-4 Vision API (차트 분석)
- Clean Architecture 기반 계층 분리: Controller → Service → Repository
- 비동기 처리(@Async)를 통한 외부 API 호출 성능 최적화
- Resilience4j를 활용한 Circuit Breaker 및 Retry 패턴 구현
- JUnit 5 + Mockito 기반 TDD 개발

## Technical Context

**Language/Version**: Java 17 (Spring Boot 3.5.7)
**Primary Dependencies**:
- Spring Web (REST API)
- Spring Security (JWT 인증/인가)
- Spring Data JPA (ORM)
- MariaDB Driver
- Lombok (보일러플레이트 제거)
- Validation (입력값 검증)
- Jackson/Gson (JSON 처리)
- JWT 라이브러리: `io.jsonwebtoken:jjwt-api:0.12.3`
- HTTP Client: `org.springframework.boot:spring-boot-starter-webflux` (WebClient for external APIs)
- Resilience4j (Circuit Breaker, Retry)
- Apache Commons IO (이미지 처리)

**Storage**: MariaDB 10.6+ (UTF-8mb4 encoding)
**Testing**: JUnit 5, Mockito, Spring Boot Test, Spring Security Test
**Target Platform**: Linux/Windows 서버 (Docker 컨테이너화 권장)
**Project Type**: Web (Backend API + React Frontend)
**Performance Goals**:
- API 응답 시간 P95 < 1초
- OpenAI Vision API 분석 P95 < 5초
- 동시 사용자 1,000명 처리 가능
- Database 쿼리 P95 < 100ms

**Constraints**:
- 한국투자증권 API Rate Limit: 분당 60회
- OpenAI API Cost Management: 일일 호출 한도 설정 필요
- 이미지 업로드 크기 제한: 5MB
- JWT Access Token 만료: 1시간, Refresh Token: 7일
- Connection timeout: 3초, Read timeout: 10초

**Scale/Scope**:
- 예상 사용자: 초기 1,000명, 성장 목표 10,000명
- API 엔드포인트: 약 20개
- 데이터베이스 테이블: 6개 (users, chart_analyses, learning_progress, trading_techniques, learning_contents, refresh_tokens)
- 학습 콘텐츠 카테고리: 8개 이상

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Constitution Compliance Checklist**:

✅ **I. Clean Code & Korean Documentation**
- 모든 코드에 한국어 주석 필수
- Clean Code 원칙 준수 (SRP, DRY, KISS)
- 매직 넘버 금지, 명명된 상수 사용

✅ **II. REST API Design Excellence**
- RESTful 설계 원칙 준수
- 계층 분리: Controller → Service → Repository
- DTO를 통한 계층 간 데이터 전달
- 일관된 응답 형식 (ApiResponse<T> 표준화)

✅ **III. Test-Driven Development (NON-NEGOTIABLE)**
- JUnit 5 기반 단위 테스트 필수
- 통합 테스트 작성
- 테스트 커버리지 70% 이상 목표
- TDD 사이클: 테스트 작성 → 실패 확인 → 구현 → 통과

✅ **IV. Performance Standards**
- API 응답 시간 1초 이하
- OpenAI Vision 분석 5초 이하
- 한국투자증권 API 최적화: Retry, Circuit Breaker, Timeout 설정
- N+1 쿼리 방지, 적절한 인덱싱

✅ **V. User-First Design**
- 한국어 에러 메시지
- 사용자 친화적 API 응답
- 접근성 고려 (향후 프론트엔드 적용)

✅ **Git Workflow**
- 기능별 브랜치: `feature/기능명`
- 커밋 메시지 형식: `feat/fix/docs/test/refactor`
- 각 기능 완료 시 자동 커밋 및 푸시

✅ **Security Requirements**
- JWT Token 기반 인증
- BCrypt 비밀번호 해싱 (strength 10)
- SQL Injection 방지 (JPA Prepared Statement)
- XSS 방지 (입력 sanitization)
- CORS 명시적 설정

**No violations detected** - 프로젝트는 Constitution의 모든 원칙을 준수합니다.

## Project Structure

### Documentation (this feature)

```text
.specify/features/tradevision-platform/
├── spec.md              # Feature specification
├── plan.md              # This file - Implementation plan
├── research.md          # Phase 0: Technical research notes
├── data-model.md        # Phase 1: Database schema & entity relationships
├── quickstart.md        # Phase 1: Development setup & API quickstart
├── contracts/           # Phase 1: API contract definitions
│   ├── auth-api.md      # 인증 관련 API contracts
│   ├── stock-api.md     # 주식 데이터 API contracts
│   ├── chart-api.md     # 차트 분석 API contracts
│   └── learning-api.md  # 학습 관련 API contracts
└── tasks.md             # Phase 2: Generated by /speckit.tasks (NOT by this plan)
```

### Source Code (repository root)

```text
tradevision/
├── build.gradle                    # Gradle 빌드 설정
├── settings.gradle                 # Gradle 프로젝트 설정
├── src/
│   ├── main/
│   │   ├── java/com/tradevision/
│   │   │   ├── TradeVisionApplication.java           # Spring Boot 메인 클래스
│   │   │   │
│   │   │   ├── config/                               # 설정 클래스
│   │   │   │   ├── SecurityConfig.java               # Spring Security + JWT 설정
│   │   │   │   ├── CorsConfig.java                   # CORS 설정
│   │   │   │   ├── WebConfig.java                    # Web MVC 설정
│   │   │   │   ├── AsyncConfig.java                  # 비동기 처리 설정
│   │   │   │   ├── JpaConfig.java                    # JPA 설정 (Auditing 등)
│   │   │   │   └── Resilience4jConfig.java           # Circuit Breaker, Retry 설정
│   │   │   │
│   │   │   ├── controller/                           # REST API 컨트롤러
│   │   │   │   ├── AuthController.java               # 인증 API (/api/auth/*)
│   │   │   │   ├── UserController.java               # 사용자 API (/api/users/*)
│   │   │   │   ├── StockController.java              # 주식 데이터 API (/api/stocks/*)
│   │   │   │   ├── ChartController.java              # 차트 분석 API (/api/charts/*)
│   │   │   │   └── LearningController.java           # 학습 API (/api/learning/*)
│   │   │   │
│   │   │   ├── service/                              # 비즈니스 로직
│   │   │   │   ├── AuthService.java                  # 회원가입, 로그인, 토큰 관리
│   │   │   │   ├── UserService.java                  # 사용자 프로필 관리
│   │   │   │   ├── StockService.java                 # 주식 데이터 조회 (한투 API 연동)
│   │   │   │   ├── ChartAnalysisService.java         # 차트 분석 히스토리 관리
│   │   │   │   ├── OpenAIService.java                # OpenAI GPT-4 Vision 연동
│   │   │   │   ├── LearningService.java              # 학습 콘텐츠 및 진도 관리
│   │   │   │   └── ImageService.java                 # 이미지 업로드/저장/최적화
│   │   │   │
│   │   │   ├── repository/                           # JPA Repository
│   │   │   │   ├── UserRepository.java               # User 엔티티 CRUD
│   │   │   │   ├── ChartAnalysisRepository.java      # ChartAnalysis 엔티티 CRUD
│   │   │   │   ├── LearningProgressRepository.java   # LearningProgress 엔티티 CRUD
│   │   │   │   ├── TradingTechniqueRepository.java   # TradingTechnique 엔티티 CRUD
│   │   │   │   ├── LearningContentRepository.java    # LearningContent 엔티티 CRUD
│   │   │   │   └── RefreshTokenRepository.java       # RefreshToken 엔티티 CRUD
│   │   │   │
│   │   │   ├── entity/                               # JPA 엔티티
│   │   │   │   ├── User.java                         # 사용자 엔티티
│   │   │   │   ├── ChartAnalysis.java                # 차트 분석 히스토리 엔티티
│   │   │   │   ├── LearningProgress.java             # 학습 진도 엔티티
│   │   │   │   ├── TradingTechnique.java             # 매매기법 마스터 데이터
│   │   │   │   ├── LearningContent.java              # 학습 콘텐츠 엔티티
│   │   │   │   ├── RefreshToken.java                 # Refresh Token 엔티티
│   │   │   │   └── BaseTimeEntity.java               # Auditing용 베이스 엔티티 (createdAt, updatedAt)
│   │   │   │
│   │   │   ├── dto/                                  # 데이터 전송 객체
│   │   │   │   ├── request/                          # 요청 DTO
│   │   │   │   │   ├── SignupRequest.java            # 회원가입 요청
│   │   │   │   │   ├── LoginRequest.java             # 로그인 요청
│   │   │   │   │   ├── RefreshTokenRequest.java      # 토큰 갱신 요청
│   │   │   │   │   ├── UpdateProfileRequest.java     # 프로필 수정 요청
│   │   │   │   │   ├── ChangePasswordRequest.java    # 비밀번호 변경 요청
│   │   │   │   │   ├── ChartAnalysisRequest.java     # 차트 분석 요청
│   │   │   │   │   └── UpdateProgressRequest.java    # 학습 진도 업데이트 요청
│   │   │   │   │
│   │   │   │   └── response/                         # 응답 DTO
│   │   │   │       ├── ApiResponse.java              # 공통 API 응답 래퍼
│   │   │   │       ├── AuthResponse.java             # 인증 응답 (accessToken, refreshToken)
│   │   │   │       ├── UserProfileResponse.java      # 사용자 프로필 응답
│   │   │   │       ├── StockDataResponse.java        # 주식 데이터 응답
│   │   │   │       ├── ChartDataResponse.java        # 차트 데이터 응답
│   │   │   │       ├── ChartAnalysisResponse.java    # AI 차트 분석 결과 응답
│   │   │   │       ├── TradingTechniqueResponse.java # 매매기법 추천 응답
│   │   │   │       ├── AnalysisHistoryResponse.java  # 분석 히스토리 응답
│   │   │   │       ├── LearningContentResponse.java  # 학습 콘텐츠 응답
│   │   │   │       └── LearningProgressResponse.java # 학습 진도 응답
│   │   │   │
│   │   │   ├── security/                             # 보안 관련
│   │   │   │   ├── JwtTokenProvider.java             # JWT 토큰 생성/검증
│   │   │   │   ├── JwtAuthenticationFilter.java      # JWT 인증 필터
│   │   │   │   ├── JwtAuthenticationEntryPoint.java  # 인증 실패 핸들러
│   │   │   │   ├── JwtAccessDeniedHandler.java       # 권한 거부 핸들러
│   │   │   │   └── CustomUserDetailsService.java     # UserDetails 구현
│   │   │   │
│   │   │   ├── external/                             # 외부 API 통합
│   │   │   │   ├── kis/                              # 한국투자증권 OpenAPI
│   │   │   │   │   ├── KisApiClient.java             # API 호출 클라이언트
│   │   │   │   │   ├── KisAuthService.java           # API 인증 토큰 관리
│   │   │   │   │   └── dto/                          # KIS API 요청/응답 DTO
│   │   │   │   │       ├── KisTokenResponse.java
│   │   │   │   │       ├── KisStockPriceResponse.java
│   │   │   │   │       └── KisChartDataResponse.java
│   │   │   │   │
│   │   │   │   └── openai/                           # OpenAI API
│   │   │   │       ├── OpenAIClient.java             # GPT-4 Vision API 클라이언트
│   │   │   │       └── dto/                          # OpenAI API 요청/응답 DTO
│   │   │   │           ├── VisionRequest.java
│   │   │   │           └── VisionResponse.java
│   │   │   │
│   │   │   ├── exception/                            # 예외 처리
│   │   │   │   ├── GlobalExceptionHandler.java       # 전역 예외 핸들러 (@RestControllerAdvice)
│   │   │   │   ├── ErrorCode.java                    # 에러 코드 enum
│   │   │   │   ├── BusinessException.java            # 비즈니스 예외 (커스텀)
│   │   │   │   ├── UnauthorizedException.java        # 인증 실패 예외
│   │   │   │   ├── ResourceNotFoundException.java    # 리소스 없음 예외
│   │   │   │   └── ExternalApiException.java         # 외부 API 호출 실패 예외
│   │   │   │
│   │   │   ├── util/                                 # 유틸리티
│   │   │   │   ├── ImageProcessor.java               # 이미지 리사이징/압축
│   │   │   │   ├── FileUploadUtil.java               # 파일 업로드 헬퍼
│   │   │   │   └── DateTimeUtil.java                 # 날짜/시간 유틸리티
│   │   │   │
│   │   │   └── constant/                             # 상수
│   │   │       ├── CandleType.java                   # 봉 종류 enum (M1, M5, M15, H1, D, W, M)
│   │   │       ├── InvestmentLevel.java              # 투자 경험 수준 enum
│   │   │       ├── FeedbackType.java                 # 분석 피드백 enum (SUCCESS, FAIL, NONE)
│   │   │       └── TechniqueCategory.java            # 학습 기법 카테고리 enum
│   │   │
│   │   └── resources/
│   │       ├── application.yml                       # Spring Boot 메인 설정
│   │       ├── application-dev.yml                   # 개발 환경 설정
│   │       ├── application-prod.yml                  # 프로덕션 환경 설정
│   │       ├── db/
│   │       │   └── migration/                        # Flyway/Liquibase 마이그레이션 스크립트
│   │       │       ├── V1__create_users_table.sql
│   │       │       ├── V2__create_chart_analyses_table.sql
│   │       │       ├── V3__create_learning_progress_table.sql
│   │       │       ├── V4__create_trading_techniques_table.sql
│   │       │       ├── V5__create_learning_contents_table.sql
│   │       │       ├── V6__create_refresh_tokens_table.sql
│   │       │       └── V7__insert_initial_data.sql   # 매매기법, 학습 콘텐츠 초기 데이터
│   │       │
│   │       ├── static/                               # 정적 리소스 (업로드 이미지 임시 저장 - 프로덕션은 S3 권장)
│   │       └── templates/                            # Thymeleaf 템플릿 (API 서버이므로 미사용)
│   │
│   └── test/
│       ├── java/com/tradevision/
│       │   ├── controller/                           # Controller 통합 테스트
│       │   │   ├── AuthControllerTest.java
│       │   │   ├── StockControllerTest.java
│       │   │   ├── ChartControllerTest.java
│       │   │   └── LearningControllerTest.java
│       │   │
│       │   ├── service/                              # Service 단위 테스트
│       │   │   ├── AuthServiceTest.java
│       │   │   ├── StockServiceTest.java
│       │   │   ├── ChartAnalysisServiceTest.java
│       │   │   ├── OpenAIServiceTest.java
│       │   │   └── LearningServiceTest.java
│       │   │
│       │   ├── repository/                           # Repository 통합 테스트
│       │   │   ├── UserRepositoryTest.java
│       │   │   ├── ChartAnalysisRepositoryTest.java
│       │   │   └── LearningProgressRepositoryTest.java
│       │   │
│       │   ├── security/                             # Security 테스트
│       │   │   ├── JwtTokenProviderTest.java
│       │   │   └── JwtAuthenticationFilterTest.java
│       │   │
│       │   └── integration/                          # End-to-End 통합 테스트
│       │       ├── AuthIntegrationTest.java          # 회원가입 → 로그인 플로우
│       │       ├── StockIntegrationTest.java         # 주식 조회 플로우
│       │       └── ChartAnalysisIntegrationTest.java # 이미지 업로드 → AI 분석 → 저장 플로우
│       │
│       └── resources/
│           ├── application-test.yml                  # 테스트 환경 설정
│           └── test-data/                            # 테스트용 샘플 데이터
│               ├── sample-chart.png                  # 테스트용 차트 이미지
│               └── sample-stock-data.json            # 테스트용 주식 데이터
│
├── frontend/                                         # React 프론트엔드 (별도 프로젝트)
│   ├── package.json
│   ├── src/
│   │   ├── components/                               # React 컴포넌트
│   │   ├── pages/                                    # 페이지 컴포넌트
│   │   ├── services/                                 # API 호출 서비스
│   │   └── App.tsx
│   └── public/
│
├── docker/                                           # Docker 관련
│   ├── Dockerfile                                    # Spring Boot 애플리케이션 이미지
│   ├── docker-compose.yml                            # 로컬 개발 환경 (MariaDB + Spring Boot)
│   └── docker-compose.prod.yml                       # 프로덕션 환경
│
└── docs/                                             # 프로젝트 문서
    ├── API.md                                        # API 문서 (Swagger 자동 생성 보완)
    ├── SETUP.md                                      # 개발 환경 설정 가이드
    └── ARCHITECTURE.md                               # 아키텍처 설명
```

**Structure Decision**:
- **Web Application 구조 선택**: Backend (Spring Boot) + Frontend (React) 분리
- **Backend**: `tradevision/src/main/java/com/tradevision/` 하위에 계층별로 패키지 구성
- **Frontend**: 별도 `frontend/` 디렉토리에 React 프로젝트 구성 (API 연동)
- **테스트**: 단위 테스트, 통합 테스트, E2E 테스트를 `src/test/` 하위에 구성
- **DB 마이그레이션**: Flyway를 사용하여 `resources/db/migration/` 에서 버전별 스크립트 관리

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | N/A | N/A |

**No complexity violations** - 프로젝트는 표준 Spring Boot 아키텍처를 따르며, 불필요한 추상화나 복잡성을 도입하지 않습니다.

## Phase 0: Research

**Goal**: 외부 API 통합, 보안 설정, 성능 최적화 방법 조사

### Research Tasks

1. **한국투자증권 OpenAPI 조사**
   - API 인증 방식 (OAuth 2.0, API Key 등)
   - 주식 데이터 조회 엔드포인트 (현재가, 차트 데이터)
   - Rate Limiting 정책 (분당 호출 제한)
   - 응답 형식 (JSON 구조)
   - 에러 코드 및 핸들링 방법
   - SDK/라이브러리 존재 여부 (또는 직접 REST 호출)

2. **OpenAI GPT-4 Vision API 조사**
   - API 인증 방식 (API Key)
   - 이미지 분석 요청 형식 (multipart/form-data or base64)
   - 프롬프트 엔지니어링 전략 (차트 분석에 최적화된 프롬프트)
   - 응답 시간 최적화 방법
   - 비용 관리 전략 (일일 한도 설정, 토큰 수 제한)
   - 에러 핸들링 (rate limit, timeout)

3. **JWT 인증 구현 Best Practices**
   - Access Token + Refresh Token 이중 토큰 전략
   - Token 저장 위치 (프론트엔드: localStorage vs HttpOnly Cookie)
   - Token 갱신 플로우
   - Spring Security 통합 방법
   - 라이브러리 선택: `io.jsonwebtoken:jjwt` vs `com.auth0:java-jwt`

4. **이미지 업로드 및 저장 전략**
   - 로컬 파일 시스템 vs S3 (프로덕션)
   - 이미지 최적화 라이브러리 (Thumbnailator, ImageIO)
   - 파일명 충돌 방지 (UUID 사용)
   - 보안: 파일 타입 검증, 크기 제한

5. **성능 최적화 기법**
   - Spring Cache 추상화 (@Cacheable) - 주식 데이터 캐싱
   - 비동기 처리 (@Async) - OpenAI API 호출
   - Database 인덱싱 전략 (user_id, stock_code, created_at)
   - Connection Pooling (HikariCP 기본 설정 최적화)
   - Resilience4j Circuit Breaker 패턴

6. **데이터베이스 설계**
   - MariaDB UTF-8mb4 설정 확인
   - JPA Entity 관계 매핑 전략 (Lazy vs Eager Loading)
   - Soft Delete vs Hard Delete
   - Auditing (createdAt, updatedAt 자동 관리)
   - 마이그레이션 도구 선택: Flyway vs Liquibase

**Deliverable**: `research.md` 파일에 조사 결과 정리

## Phase 1: Design

**Goal**: API 계약, 데이터 모델, 개발 환경 설정 문서 작성

### Design Tasks

#### 1.1 Database Schema Design (`data-model.md`)

**테이블 설계**:

```sql
-- users: 사용자 정보
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,  -- BCrypt 해시
    nickname VARCHAR(50) NOT NULL,
    investment_level ENUM('BEGINNER', 'INTERMEDIATE', 'ADVANCED') DEFAULT 'BEGINNER',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- refresh_tokens: Refresh Token 저장
CREATE TABLE refresh_tokens (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    token VARCHAR(500) NOT NULL UNIQUE,
    expires_at DATETIME NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_token (token)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- chart_analyses: 차트 분석 히스토리
CREATE TABLE chart_analyses (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    stock_code VARCHAR(10),
    stock_name VARCHAR(100),
    candle_type ENUM('M1', 'M5', 'M15', 'H1', 'D', 'W', 'M') NOT NULL,
    image_path VARCHAR(500) NOT NULL,
    analysis_result JSON NOT NULL,  -- AI 분석 결과 (패턴, 지지/저항선, 의견 등)
    feedback ENUM('SUCCESS', 'FAIL', 'NONE') DEFAULT 'NONE',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_stock_code (stock_code),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- trading_techniques: 매매기법 마스터 데이터
CREATE TABLE trading_techniques (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    candle_type ENUM('M1', 'M5', 'M15', 'H1', 'D', 'W', 'M') NOT NULL,
    description TEXT NOT NULL,
    learning_content_id BIGINT,
    priority INT NOT NULL DEFAULT 0,  -- 표시 우선순위
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_candle_type (candle_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- learning_contents: 학습 콘텐츠
CREATE TABLE learning_contents (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    category VARCHAR(50) NOT NULL UNIQUE,  -- 예: "이동평균선", "볼린저밴드"
    title VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    calculation_method TEXT,
    usage_strategy TEXT,
    pros_cons TEXT,
    interactive_config JSON,  -- 인터랙티브 차트 설정
    related_content_ids JSON,  -- 관련 기법 ID 배열
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_category (category)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- learning_progress: 사용자별 학습 진도
CREATE TABLE learning_progress (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    learning_content_id BIGINT NOT NULL,
    completed BOOLEAN DEFAULT FALSE,
    completed_at DATETIME,
    last_accessed_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (learning_content_id) REFERENCES learning_contents(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_content (user_id, learning_content_id),
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Entity Relationships**:
- User 1:N ChartAnalysis
- User 1:N LearningProgress
- User 1:N RefreshToken
- LearningContent 1:N LearningProgress
- TradingTechnique N:1 LearningContent (optional)

#### 1.2 API Contracts (`contracts/`)

각 API 도메인별로 계약 문서 작성:

**`contracts/auth-api.md`**:
```markdown
# Authentication API Contracts

## POST /api/auth/signup
**Description**: 회원가입
**Request**:
{
  "email": "user@example.com",
  "password": "password123",
  "nickname": "투자초보"
}
**Response 201**:
{
  "success": true,
  "data": {
    "userId": 1,
    "email": "user@example.com",
    "nickname": "투자초보"
  },
  "message": "회원가입이 완료되었습니다."
}
**Errors**:
- 400: 이메일 형식 오류, 비밀번호 조건 미충족
- 409: 이미 존재하는 이메일

## POST /api/auth/login
...
```

**`contracts/stock-api.md`**:
```markdown
# Stock Data API Contracts

## GET /api/stocks/{code}
**Description**: 실시간 주가 조회
...
```

**`contracts/chart-api.md`**, **`contracts/learning-api.md`** 유사하게 작성

#### 1.3 Development Quickstart (`quickstart.md`)

**내용**:
- 로컬 개발 환경 설정 (Java 17, Gradle, MariaDB 설치)
- Docker Compose를 이용한 MariaDB 실행
- 환경 변수 설정 (`.env` 파일)
- 애플리케이션 실행 방법
- 테스트 실행 방법
- Swagger UI 접속 방법 (`http://localhost:8080/swagger-ui.html`)

**Deliverables**:
- `data-model.md`
- `quickstart.md`
- `contracts/auth-api.md`
- `contracts/stock-api.md`
- `contracts/chart-api.md`
- `contracts/learning-api.md`

## Phase 2: Implementation Phases

### Phase 2.1: 기본 프로젝트 구조 및 설정 (Foundation)

**Goals**:
- Spring Boot 프로젝트 초기 설정 완료
- 데이터베이스 연결 및 마이그레이션 설정
- 기본 설정 클래스 작성 (Security, CORS, JPA, Async, Resilience4j)

**Tasks**:
1. `build.gradle`에 필요한 의존성 추가
   - JWT: `io.jsonwebtoken:jjwt-api:0.12.3`, `jjwt-impl`, `jjwt-jackson`
   - WebClient: `spring-boot-starter-webflux`
   - Resilience4j: `resilience4j-spring-boot3`
   - Flyway: `org.flywaydb:flyway-core`, `flyway-mysql`
   - Image processing: `net.coobird:thumbnailator:0.4.19`
   - Swagger: `springdoc-openapi-starter-webmvc-ui:2.2.0`

2. `application.yml` 설정
   - 데이터베이스 연결 (MariaDB UTF-8mb4)
   - JPA 설정 (DDL auto: validate, show-sql: true in dev)
   - Logging 설정
   - File upload size limit (5MB)
   - JWT secret key (환경 변수)
   - 외부 API 키 (환경 변수)

3. Flyway 마이그레이션 스크립트 작성
   - `V1__create_users_table.sql` ~ `V7__insert_initial_data.sql`

4. 설정 클래스 작성
   - `SecurityConfig.java`: JWT 필터 등록, CSRF 비활성화, CORS 설정
   - `CorsConfig.java`: 프론트엔드 도메인 허용
   - `JpaConfig.java`: Auditing 활성화 (`@EnableJpaAuditing`)
   - `AsyncConfig.java`: `@EnableAsync`, ThreadPoolTaskExecutor 설정
   - `Resilience4jConfig.java`: Circuit Breaker, Retry 정책 설정

5. 상수 클래스 작성
   - `CandleType.java`, `InvestmentLevel.java`, `FeedbackType.java`, `TechniqueCategory.java`

6. 예외 처리 클래스 작성
   - `ErrorCode.java`: 에러 코드 enum
   - `BusinessException.java`, `UnauthorizedException.java`, `ResourceNotFoundException.java`, `ExternalApiException.java`
   - `GlobalExceptionHandler.java`: `@RestControllerAdvice`로 전역 예외 핸들링

7. 공통 응답 DTO 작성
   - `ApiResponse.java`: 제네릭 래퍼 (`success`, `data`, `message`, `errorCode`)

**테스트**:
- 애플리케이션 정상 실행 확인
- Flyway 마이그레이션 성공 확인
- Swagger UI 접속 확인

---

### Phase 2.2: 사용자 인증 시스템 (JWT Authentication)

**Goals**:
- 회원가입, 로그인, 토큰 갱신 API 구현
- JWT 토큰 생성/검증 로직 구현
- Spring Security 통합

**Tasks**:
1. Entity 작성
   - `User.java`: `@Entity`, Auditing (`BaseTimeEntity` 상속)
   - `RefreshToken.java`
   - `BaseTimeEntity.java`: `@MappedSuperclass`, `createdAt`, `updatedAt`

2. Repository 작성
   - `UserRepository.java`: `findByEmail()`, `existsByEmail()`
   - `RefreshTokenRepository.java`: `findByToken()`, `deleteByUserId()`

3. Security 구현
   - `JwtTokenProvider.java`:
     - `generateAccessToken(String email)`: 1시간 유효
     - `generateRefreshToken(String email)`: 7일 유효
     - `validateToken(String token)`: 토큰 검증
     - `getEmailFromToken(String token)`: 이메일 추출
   - `CustomUserDetailsService.java`: `loadUserByUsername()` 구현
   - `JwtAuthenticationFilter.java`: `OncePerRequestFilter` 상속, Authorization 헤더에서 토큰 추출 및 검증
   - `JwtAuthenticationEntryPoint.java`: 401 에러 커스텀 응답
   - `JwtAccessDeniedHandler.java`: 403 에러 커스텀 응답

4. DTO 작성
   - Request: `SignupRequest.java` (validation 어노테이션), `LoginRequest.java`, `RefreshTokenRequest.java`
   - Response: `AuthResponse.java` (accessToken, refreshToken, user 정보)

5. Service 작성
   - `AuthService.java`:
     - `signup(SignupRequest)`: 이메일 중복 확인, BCrypt 암호화, User 저장
     - `login(LoginRequest)`: 이메일/비밀번호 검증, 토큰 발급, RefreshToken 저장
     - `refresh(RefreshTokenRequest)`: Refresh Token 검증, 새 Access Token 발급

6. Controller 작성
   - `AuthController.java`:
     - `POST /api/auth/signup`
     - `POST /api/auth/login`
     - `POST /api/auth/refresh`

**테스트**:
- `AuthServiceTest.java`: 회원가입, 로그인, 토큰 갱신 단위 테스트 (Mockito)
- `JwtTokenProviderTest.java`: 토큰 생성/검증 테스트
- `AuthControllerTest.java`: API 통합 테스트 (`@WebMvcTest` or `@SpringBootTest`)
- `AuthIntegrationTest.java`: E2E 테스트 (회원가입 → 로그인 → 보호된 API 호출)

**Git Commit**: `feat: 사용자 인증 시스템 구현 (JWT)`

---

### Phase 2.3: 사용자 프로필 관리

**Goals**:
- 프로필 조회, 수정, 비밀번호 변경 API 구현

**Tasks**:
1. DTO 작성
   - Request: `UpdateProfileRequest.java`, `ChangePasswordRequest.java`
   - Response: `UserProfileResponse.java`

2. Service 작성
   - `UserService.java`:
     - `getProfile(Long userId)`: 사용자 정보 조회
     - `updateProfile(Long userId, UpdateProfileRequest)`: 닉네임, 투자 경험 수준 수정
     - `changePassword(Long userId, ChangePasswordRequest)`: 현재 비밀번호 확인, 새 비밀번호 암호화 후 저장

3. Controller 작성
   - `UserController.java`:
     - `GET /api/users/profile`: 인증 필요 (`@AuthenticationPrincipal`)
     - `PUT /api/users/profile`
     - `PUT /api/users/password`
     - `DELETE /api/users`: 회원 탈퇴 (Soft Delete 또는 Hard Delete)

**테스트**:
- `UserServiceTest.java`
- `UserControllerTest.java`

**Git Commit**: `feat: 사용자 프로필 관리 기능 구현`

---

### Phase 2.4: 한국투자증권 OpenAPI 연동

**Goals**:
- 실시간 주식 데이터 조회 API 구현
- 한국투자증권 API 인증 및 호출 로직 구현
- Retry, Circuit Breaker 패턴 적용

**Tasks**:
1. 외부 API 클라이언트 작성
   - `KisApiClient.java`:
     - `WebClient` 설정 (base URL, timeout)
     - `@Retry`, `@CircuitBreaker` 어노테이션 적용
     - `getStockPrice(String stockCode)`: 현재가 조회
     - `getChartData(String stockCode, CandleType candleType)`: 차트 데이터 조회
   - `KisAuthService.java`:
     - API 인증 토큰 발급 및 갱신 (한투 API 인증 방식에 따라)
     - 토큰 만료 시 자동 갱신

2. DTO 작성
   - `KisTokenResponse.java`, `KisStockPriceResponse.java`, `KisChartDataResponse.java`
   - `StockDataResponse.java`, `ChartDataResponse.java` (내부 응답 DTO)

3. Service 작성
   - `StockService.java`:
     - `getStockPrice(String stockCode)`: KIS API 호출 → 응답 변환
     - `getChartData(String stockCode, CandleType candleType)`: 차트 데이터 조회
     - `@Cacheable` 적용 (1분 캐싱 - 실시간성 고려)

4. Controller 작성
   - `StockController.java`:
     - `GET /api/stocks/{code}`: 현재가 조회 (인증 필요)
     - `GET /api/stocks/{code}/chart?candle={candleType}`: 차트 데이터 조회

**테스트**:
- `KisApiClientTest.java`: Mock 서버로 API 호출 테스트
- `StockServiceTest.java`: Mockito로 KisApiClient mocking
- `StockControllerTest.java`
- `StockIntegrationTest.java`: 실제 API 호출 (선택적, API 키 필요)

**Git Commit**: `feat: 한국투자증권 OpenAPI 연동 및 주식 데이터 조회 구현`

---

### Phase 2.5: 봉 종류별 매매기법 추천

**Goals**:
- 봉 종류별 추천 매매기법 마스터 데이터 관리
- 매매기법 추천 API 구현

**Tasks**:
1. Entity 작성
   - `TradingTechnique.java`
   - `LearningContent.java`

2. Repository 작성
   - `TradingTechniqueRepository.java`: `findByCandleTypeOrderByPriorityAsc(CandleType)`
   - `LearningContentRepository.java`

3. 초기 데이터 마이그레이션
   - `V7__insert_initial_data.sql`: 봉 종류별 매매기법 INSERT
     - 예: (name='스캘핑', candle_type='M1', description='...', priority=1)

4. DTO 작성
   - `TradingTechniqueResponse.java`

5. Service 작성
   - `LearningService.java`:
     - `getTradingTechniquesByCandleType(CandleType)`: 매매기법 리스트 조회

6. Controller 작성
   - `ChartController.java`:
     - `GET /api/charts/techniques/{candleType}`: 추천 기법 조회

**테스트**:
- `LearningServiceTest.java`
- `ChartControllerTest.java`

**Git Commit**: `feat: 봉 종류별 매매기법 추천 기능 구현`

---

### Phase 2.6: OpenAI GPT-4 Vision API 연동 및 차트 분석

**Goals**:
- 차트 이미지 업로드 기능 구현
- OpenAI GPT-4 Vision을 통한 차트 분석 구현
- 분석 결과 저장 및 조회 API 구현

**Tasks**:
1. 이미지 업로드 및 처리
   - `ImageService.java`:
     - `saveImage(MultipartFile file)`: 파일 검증 (타입, 크기), UUID 파일명 생성, 저장 (로컬 또는 S3)
     - `optimizeImage(File file)`: Thumbnailator로 리사이징/압축
   - `FileUploadUtil.java`: 파일 검증 헬퍼 메서드

2. OpenAI API 클라이언트
   - `OpenAIClient.java`:
     - `WebClient` 설정 (base URL: `https://api.openai.com/v1/`)
     - `analyzeChart(String imagePath, String prompt)`: GPT-4 Vision API 호출
     - `@Async` 적용 (비동기 처리)
     - Timeout 설정 (10초)
   - Prompt Engineering:
     ```
     당신은 주식 차트 분석 전문가입니다.
     첨부된 차트 이미지를 분석하여 다음 정보를 제공해주세요:
     1. 차트 패턴 (헤드앤숄더, 쌍봉, 삼각수렴 등)
     2. 주요 지지선과 저항선 가격
     3. 이동평균선 배열 상태
     4. 거래량 분석
     5. 매수/매도/관망 의견 및 구체적인 근거

     JSON 형식으로 응답해주세요.
     ```

3. DTO 작성
   - Request: `ChartAnalysisRequest.java` (multipart file)
   - Response: `ChartAnalysisResponse.java` (패턴, 지지선, 저항선, 이동평균선, 거래량, 의견, 근거)
   - External: `VisionRequest.java`, `VisionResponse.java`

4. Entity 작성
   - `ChartAnalysis.java`: `analysisResult`를 JSON 타입으로 저장 (`@Convert(converter = JsonConverter.class)`)

5. Repository 작성
   - `ChartAnalysisRepository.java`:
     - `findByUserIdOrderByCreatedAtDesc(Long userId, Pageable)`
     - `findByUserIdAndStockCodeContaining(Long userId, String stockCode)`

6. Service 작성
   - `ChartAnalysisService.java`:
     - `analyzeChart(Long userId, MultipartFile file, String stockCode, CandleType candleType)`:
       1. 이미지 저장 (`ImageService`)
       2. OpenAI API 호출 (`OpenAIClient`)
       3. 분석 결과 파싱 및 ChartAnalysis 엔티티 저장
     - `getAnalysisHistory(Long userId, Pageable)`: 히스토리 조회
     - `getAnalysisById(Long id)`: 특정 분석 상세 조회
     - `updateFeedback(Long id, FeedbackType feedback)`: 피드백 저장
     - `compareAnalyses(Long id1, Long id2)`: 두 분석 비교

7. Controller 작성
   - `ChartController.java`:
     - `POST /api/charts/upload`: 이미지 업로드 (멀티파트)
     - `POST /api/charts/analyze`: AI 분석 실행
     - `GET /api/charts/history`: 히스토리 조회 (페이지네이션, 필터링)
     - `GET /api/charts/history/{id}`: 분석 상세
     - `PUT /api/charts/history/{id}/feedback`: 피드백 업데이트
     - `DELETE /api/charts/history/{id}`: 분석 삭제

**테스트**:
- `ImageServiceTest.java`: 파일 업로드, 검증 테스트
- `OpenAIClientTest.java`: Mock API 응답 테스트
- `ChartAnalysisServiceTest.java`
- `ChartControllerTest.java`
- `ChartAnalysisIntegrationTest.java`: 이미지 업로드 → 분석 → 저장 → 조회 E2E 테스트

**Git Commit**: `feat: OpenAI GPT-4 Vision 연동 및 AI 차트 분석 기능 구현`

---

### Phase 2.7: 분석 히스토리 관리

**Goals**:
- 날짜/종목별 필터링 기능 구현
- 분석 결과 비교 기능 구현

**Tasks**:
1. Service 확장
   - `ChartAnalysisService.java`:
     - `getAnalysisHistoryByDateRange(Long userId, LocalDate startDate, LocalDate endDate)`
     - `searchAnalysisByStockName(Long userId, String stockName)`

2. Controller 확장
   - `ChartController.java`:
     - `GET /api/charts/history?startDate=2024-01-01&endDate=2024-12-31`
     - `GET /api/charts/history?stockName=삼성전자`
     - `GET /api/charts/compare?id1=1&id2=2`: 두 분석 비교

**테스트**:
- 필터링 및 비교 기능 테스트

**Git Commit**: `feat: 분석 히스토리 필터링 및 비교 기능 구현`

---

### Phase 2.8: 학습 페이지 데이터 API

**Goals**:
- 학습 콘텐츠 CRUD API 구현
- 학습 진도 추적 API 구현

**Tasks**:
1. Entity 작성
   - `LearningContent.java`, `LearningProgress.java`

2. Repository 작성
   - `LearningContentRepository.java`: `findByCategory()`, `findAll()`
   - `LearningProgressRepository.java`: `findByUserIdAndLearningContentId()`, `countByUserIdAndCompletedTrue()`

3. 초기 데이터 마이그레이션
   - `V7__insert_initial_data.sql`: 학습 콘텐츠 INSERT
     - 예: (category='이동평균선', title='이동평균선 완벽 가이드', description='...', ...)

4. DTO 작성
   - Request: `UpdateProgressRequest.java`
   - Response: `LearningContentResponse.java`, `LearningProgressResponse.java`

5. Service 작성
   - `LearningService.java`:
     - `getAllLearningContents()`: 전체 학습 콘텐츠 조회
     - `getLearningContentById(Long id)`: 상세 조회
     - `getLearningContentsByCategory(TechniqueCategory category)`: 카테고리별 조회
     - `getUserProgress(Long userId)`: 사용자 학습 진도 조회
     - `updateProgress(Long userId, Long contentId, boolean completed)`: 진도 업데이트

6. Controller 작성
   - `LearningController.java`:
     - `GET /api/learning/contents`: 전체 학습 콘텐츠 목록
     - `GET /api/learning/contents/{id}`: 상세 조회
     - `GET /api/learning/contents/category/{category}`: 카테고리별 조회
     - `GET /api/learning/progress`: 내 학습 진도
     - `PUT /api/learning/progress`: 진도 업데이트

**테스트**:
- `LearningServiceTest.java`
- `LearningControllerTest.java`

**Git Commit**: `feat: 학습 페이지 데이터 API 구현`

---

### Phase 2.9: 성능 최적화 및 에러 핸들링 강화

**Goals**:
- 캐싱, 비동기 처리, 인덱싱 적용
- 에러 핸들링 및 로깅 강화

**Tasks**:
1. 캐싱 적용
   - `StockService.java`: `@Cacheable("stockData")` 적용
   - `LearningService.java`: `@Cacheable("learningContents")` 적용
   - `application.yml`: 캐시 TTL 설정 (1분)

2. 비동기 처리
   - `OpenAIService.java`: `@Async` 적용
   - Future/CompletableFuture 반환

3. Database 인덱싱
   - 마이그레이션 스크립트에서 인덱스 추가 확인
   - Query Performance 모니터링

4. Rate Limiting
   - AOP를 이용한 API Rate Limiting 구현 (선택적)
   - 또는 Spring Cloud Gateway 사용 (향후)

5. 로깅 강화
   - `logback-spring.xml` 설정
   - 에러 레벨별 로그 분리
   - 민감 정보 마스킹

**테스트**:
- 성능 테스트 (JMeter 또는 Gatling)
- 캐싱 동작 확인

**Git Commit**: `refactor: 성능 최적화 및 에러 핸들링 강화`

---

### Phase 2.10: 테스트 커버리지 확보 및 문서화

**Goals**:
- 테스트 커버리지 70% 이상 달성
- Swagger API 문서 완성
- README 및 개발 가이드 작성

**Tasks**:
1. 단위 테스트 보완
   - 모든 Service 클래스 테스트 작성
   - Repository 테스트 작성 (`@DataJpaTest`)

2. 통합 테스트 보완
   - Controller 통합 테스트 (`@SpringBootTest` + `MockMvc`)
   - E2E 시나리오 테스트

3. Test Coverage 측정
   - JaCoCo 플러그인 추가
   - `./gradlew test jacocoTestReport`
   - 커버리지 70% 미달 시 테스트 추가

4. Swagger 설정
   - `@OpenAPIDefinition`, `@Operation`, `@ApiResponse` 어노테이션 추가
   - Swagger UI에서 모든 API 문서 확인

5. 문서 작성
   - `README.md`: 프로젝트 소개, 기능, 기술 스택
   - `docs/SETUP.md`: 개발 환경 설정 가이드
   - `docs/ARCHITECTURE.md`: 아키텍처 설명
   - `docs/API.md`: Swagger 보완 설명

**Git Commit**: `docs: 테스트 커버리지 확보 및 문서화 완료`

---

### Phase 2.11: 프론트엔드 연동 준비

**Goals**:
- CORS 설정 확인
- 프론트엔드 개발자를 위한 API 가이드 제공

**Tasks**:
1. CORS 설정 확인
   - `CorsConfig.java`: 프론트엔드 도메인 허용 (예: `http://localhost:3000`)
   - Credentials 허용 설정

2. API 엔드포인트 목록 정리
   - Postman Collection 생성 (선택적)
   - Swagger JSON export

3. 샘플 요청/응답 제공
   - 각 API별 cURL 예제 작성

**Git Commit**: `chore: 프론트엔드 연동 준비 완료`

---

## Phase 3: Testing & Quality Assurance

### Testing Strategy

#### Unit Tests (단위 테스트)
- **Target**: Service, Repository, Utility 클래스
- **Framework**: JUnit 5 + Mockito
- **Coverage Goal**: 80% 이상
- **Focus**:
  - 비즈니스 로직 검증
  - Edge case 처리
  - 예외 상황 테스트

#### Integration Tests (통합 테스트)
- **Target**: Controller, External API Client
- **Framework**: Spring Boot Test + MockMvc
- **Focus**:
  - API 엔드포인트 동작 확인
  - Request/Response 형식 검증
  - 인증/인가 플로우 테스트
  - 데이터베이스 통합 테스트

#### End-to-End Tests (E2E 테스트)
- **Target**: 주요 사용자 시나리오
- **Framework**: Spring Boot Test + TestRestTemplate
- **Scenarios**:
  - 회원가입 → 로그인 → 프로필 조회
  - 로그인 → 주식 조회 → 차트 분석 요청 → 히스토리 조회
  - 학습 콘텐츠 조회 → 진도 업데이트

#### Performance Tests (성능 테스트)
- **Tool**: JMeter or Gatling
- **Metrics**:
  - API 응답 시간 P95 < 1초
  - 동시 사용자 1,000명 처리 가능
  - OpenAI API 호출 시간 < 5초

### Test Data Management
- **Test Fixtures**: `src/test/resources/test-data/`
- **Sample Images**: 차트 이미지 샘플 준비
- **Mock Responses**: 외부 API 응답 JSON 파일 준비

## Phase 4: Deployment & Monitoring

### Deployment Strategy

#### Docker Containerization
```dockerfile
# Dockerfile (Spring Boot)
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

#### Docker Compose (로컬/개발)
```yaml
version: '3.8'
services:
  mariadb:
    image: mariadb:10.6
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: tradevision
      MYSQL_USER: tradevision
      MYSQL_PASSWORD: tradevision123
    ports:
      - "3306:3306"
    volumes:
      - mariadb_data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  backend:
    build: .
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DATASOURCE_URL: jdbc:mariadb://mariadb:3306/tradevision
      JWT_SECRET: ${JWT_SECRET}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      KIS_API_KEY: ${KIS_API_KEY}
    depends_on:
      - mariadb

volumes:
  mariadb_data:
```

### Monitoring & Logging

#### Logging
- **Framework**: SLF4J + Logback
- **Levels**: DEBUG (dev), INFO (prod), ERROR (always)
- **Format**: JSON structured logging (프로덕션)
- **Retention**: 30일

#### Monitoring (향후 고려)
- Spring Boot Actuator (`/actuator/health`, `/actuator/metrics`)
- Prometheus + Grafana
- Application Performance Monitoring (APM): New Relic, DataDog

## Risk Assessment & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| 한국투자증권 API 불안정 | High | Medium | Retry + Circuit Breaker, 캐싱, Fallback 응답 |
| OpenAI API 비용 초과 | High | Medium | 일일 호출 한도 설정, 사용량 모니터링, 알림 |
| 대용량 이미지 업로드 성능 저하 | Medium | Low | 파일 크기 제한 (5MB), 이미지 압축, 비동기 처리 |
| JWT 토큰 탈취 | High | Low | HTTPS 강제, HttpOnly Cookie (Refresh Token), 짧은 Access Token 유효기간 |
| 데이터베이스 성능 저하 | Medium | Medium | 인덱싱, Connection Pooling, 쿼리 최적화, Read Replica (향후) |
| 동시 사용자 급증 | Medium | Low | Horizontal Scaling (Stateless API), Load Balancer, 캐싱 |

## Open Questions & Next Steps

### Open Questions
1. **한국투자증권 API 인증 방식**: OAuth 2.0 / API Key 중 어떤 방식? → Phase 0 Research에서 확인 필요
2. **OpenAI API 비용 한도**: 일일/월간 예산 설정 필요 → 사용자와 협의
3. **이미지 저장 위치**: 로컬 파일 시스템 vs AWS S3 → 프로덕션 환경에서는 S3 권장
4. **프리미엄 구독 모델**: 무료/유료 구분 여부 → Phase 1에서는 전체 무료, 향후 고려
5. **모바일 앱 개발**: 웹 우선, 모바일 앱은 Phase 2 이후 고려

### Next Steps After Implementation
1. **프론트엔드 개발**: React 기반 SPA 구현
2. **성능 튜닝**: 실사용 데이터 기반 최적화
3. **보안 강화**: Penetration Testing, OWASP Top 10 점검
4. **CI/CD 파이프라인**: GitHub Actions + Docker + AWS ECS/Kubernetes
5. **사용자 피드백 수집**: 베타 테스트, 개선 사항 반영

## Version Control Strategy

### Branch Naming
- `feature/user-authentication`
- `feature/stock-api-integration`
- `feature/chart-analysis`
- `feature/learning-contents`
- `fix/jwt-token-expiry`
- `refactor/service-layer-optimization`

### Commit Message Convention
```
feat: 새로운 기능 추가 (예: feat: JWT 인증 시스템 구현)
fix: 버그 수정 (예: fix: 토큰 만료 시 갱신 로직 오류 수정)
docs: 문서 수정 (예: docs: API 문서 업데이트)
test: 테스트 코드 추가/수정 (예: test: AuthService 단위 테스트 추가)
refactor: 코드 리팩토링 (예: refactor: Service 계층 코드 정리)
chore: 빌드 설정, 패키지 매니저 설정 등 (예: chore: Gradle 의존성 업데이트)
```

### Pull Request Workflow
1. Feature 브랜치에서 개발
2. 테스트 작성 및 통과 확인
3. PR 생성 (제목: `[Feature] 기능명`)
4. Code Review (Constitution Checklist 확인)
5. Squash and Merge to main
6. 자동 배포 (CI/CD)

## Success Metrics

### Technical Metrics
- ✅ 테스트 커버리지 70% 이상
- ✅ API 응답 시간 P95 < 1초
- ✅ OpenAI Vision 분석 P95 < 5초
- ✅ 빌드 성공률 95% 이상
- ✅ 프로덕션 에러율 < 1%

### Business Metrics
- 월간 활성 사용자 (MAU) 1,000명 달성
- AI 차트 분석 사용률 30% 이상
- 학습 페이지 방문율 40% 이상
- 7일 리텐션 70% 이상
- 사용자 만족도 (NPS) 50+ 달성

## Timeline Estimate

| Phase | Duration | Dependencies |
|-------|----------|--------------|
| Phase 0: Research | 3일 | 없음 |
| Phase 1: Design | 3일 | Phase 0 완료 |
| Phase 2.1: 기본 설정 | 2일 | Phase 1 완료 |
| Phase 2.2: 사용자 인증 | 3일 | Phase 2.1 완료 |
| Phase 2.3: 프로필 관리 | 1일 | Phase 2.2 완료 |
| Phase 2.4: 한투 API 연동 | 4일 | Phase 2.1 완료 |
| Phase 2.5: 매매기법 추천 | 2일 | Phase 2.1 완료 |
| Phase 2.6: AI 차트 분석 | 5일 | Phase 2.2, 2.4 완료 |
| Phase 2.7: 히스토리 관리 | 2일 | Phase 2.6 완료 |
| Phase 2.8: 학습 페이지 API | 3일 | Phase 2.5 완료 |
| Phase 2.9: 성능 최적화 | 3일 | Phase 2.6, 2.8 완료 |
| Phase 2.10: 테스트 & 문서화 | 4일 | 전체 Phase 2 완료 |
| Phase 2.11: 프론트엔드 연동 | 1일 | Phase 2.10 완료 |
| **Total** | **약 33일** | - |

## Appendix

### Useful Commands

```bash
# 프로젝트 빌드
./gradlew clean build

# 테스트 실행
./gradlew test

# 테스트 커버리지 리포트
./gradlew test jacocoTestReport

# 애플리케이션 실행
./gradlew bootRun

# Docker 이미지 빌드
docker build -t tradevision-backend .

# Docker Compose 실행
docker-compose up -d

# 로그 확인
docker-compose logs -f backend
```

### References
- Spring Boot Documentation: https://spring.io/projects/spring-boot
- Spring Security + JWT: https://spring.io/guides/gs/securing-web/
- OpenAI API Documentation: https://platform.openai.com/docs/api-reference
- MariaDB UTF-8mb4 Setup: https://mariadb.com/kb/en/setting-character-sets-and-collations/
- Resilience4j: https://resilience4j.readme.io/docs

---

**Plan Version**: 1.0.0
**Last Updated**: 2025-11-16
**Status**: Ready for Phase 0 Research
